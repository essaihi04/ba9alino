-- Replace the RPC call in UserAccountsPage.tsx with this:

// Instead of RPC, use admin client directly
const supabaseAdmin = createClient(
  import.meta.env.VITE_SUPABASE_URL,
  import.meta.env.VITE_SUPABASE_SERVICE_ROLE_KEY,
  {
    auth: {
      autoRefreshToken: false,
      persistSession: false
    }
  }
);

const { data: authData, error: authError } = await supabaseAdmin.auth.admin.createUser({
  email,
  password,
  email_confirm: true,
  user_metadata: {
    username: formData.username,
    full_name: formData.full_name,
    role: formData.role
  }
});

if (authError) throw authError;

// Then create user_accounts record
const { data: accountData, error: accountError } = await supabase
  .from('user_accounts')
  .insert({
    username: formData.username,
    email,
    full_name: formData.full_name,
    role: formData.role,
    employee_id: formData.role !== 'admin' ? (formData.employee_id || null) : null,
    is_active: formData.is_active,
    auth_user_id: authData.user.id
  })
  .select()
  .single();

if (accountError) throw accountError;
